<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/bootstrap-grid.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  <script src="js/datamaps.world.min.js"></script>

  <!-- <script src="HelperFunctions.js"></script> -->
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  <title>MOMA and Art Movements</title>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3">
        <h1>Post-Impressionism (1855-1901)</h1>
        <p>Post-Impressionism (also spelled Postimpressionism) is a predominantly French art movement that developed roughly
          between 1886 and 1905, from the last Impressionist exhibition to the birth of Fauvism. Post-Impressionism emerged
          as a reaction against Impressionists' concern for the naturalistic depiction of light and colour. </p>
        <svg id="donut"></svg>
      </div>
      <div class="col-sm-9">
        <div id="container" style="position: relative; width: 100%; height: 600px;"></div>
      </div>
    </div>
  </div>
  <div id="timebar" style="margin-left: 100px;">
  </div>

  <script type="text/javascript">
    //var map = new Datamap({element: document.getElementById('container')});
    var countries = ['(American)', '(Austrian)', "(Russian)"]
    var countForEachCountry = {
      "(American)": 0,
      '(Austrian)': 0,
      "(Russian)": 0
    };
    //console.log(countForEachCountry["(American)"])
    //queue()
    //.defer(d3.csv, "moma.csv")
    //.defer(d3.json, "us.json")
    //.await(ready);
    d3.csv("moma.csv", function (data) {
      for (let idx in data) {
        let artWorkData = data[idx];
        for (let i in countries) {
          if (artWorkData.Nationality == countries[i]) {
            countForEachCountry[countries[i]] = countForEachCountry[countries[i]] + 1;

          }
        }

        //console.log(countries[1])
      }
      var bubble_map = new Datamap({
        element: document.getElementById("container"),
        scope: 'world',
        geographyConfig: {
          popupOnHover: false,
          highlightOnHover: false
        },
        fills: {
          'USA': '#1f77b4',
          'RUS': '#9467bd',
          'AUT': '#ff7f0e',
          defaultFill: '#6e6e6e'
        },
        data: {
          'USA': {
            fillKey: 'USA'
          },
          'RUS': {
            fillKey: 'RUS'
          },
          'AUT': {
            fillKey: 'PRC'
          }
        }

      });

      bubble_map.bubbles([{
          radius: 15,
          count: countForEachCountry["(Austrian)"],
          country: 'AUT',
          centered: 'AUT',
          fillKey: 'AUT'
        },
        {
          radius: 25,
          count: countForEachCountry["(American)"],
          country: 'USA',
          centered: 'USA',
          fillKey: 'USA',
        }, {
          radius: 70,
          count: countForEachCountry["(Russian)"],
          centered: 'RUS',
          country: 'USSR',
          fillKey: 'RUS',
        }
      ], {
        popupTemplate: function (geo, data) {
          console.log(data)
          return '<div class="hoverinfo">Artwork:' + data.count + ' in ' + data.country + ''
        }
      });
    });

    //function ready(error,sd){
    //  var artWorkData = sd;
    //  var symbols= drawMap(artWorkData);
    //}
    // time bar codes start here:
    var categories = ['Impressionism & Post-Impressionism & Expressionism', 'Cubism', 'Bauhaus',
      'Abstract Expressionism', 'Pop Art & Minimalism', 'Postmodernism and Deconstructivism'
    ];

    var yeartext = ["1865-1914", "1905-20", "1919-33", "1940-50", "1950-70", "1971-2000"];

    var year = [49, 15, 14, 10, 20, 29];

    var colors = ['#0000b4', '#0082ca', '#0094ff', '#0d4bcf', '#0066AE', '#074285'];

    var xscale = d3.scale.linear()
      .domain([0, 49])
      .range([0, 300]);

    var yscale = d3.scale.linear()
      .domain([0, categories.length])
      .range([50, 150]);

    var colorScale = d3.scale.quantize()
      .domain([0, categories.length])
      .range(colors);

    var canvas = d3.select('#timebar')
      .append('svg')
      .attr({
        'width': 995,
        'height': 180
      });


    var chart = canvas.append('g')
      .attr("transform", "translate(150,0)")
      .attr('id', 'bars')
      .selectAll('rect')
      .data(year)
      .enter()
      .append('rect')
      .attr('height', 15)
      .attr({
        'x': function (d, i) {
          if (i == 0) {
            return xscale(0);
          } else if (i == 1) {
            return xscale(40);
          } else if (i == 2) {
            return xscale(54);
          } else if (i == 3) {
            return xscale(75);
          } else if (i == 4) {
            return xscale(85);
          } else if (i == 5) {
            return xscale(105);
          }
        },
        'y': function (d, i) {
          return yscale(i);
        }
      })
      .style('fill', function (d, i) {
        return colorScale(i);
      })
      .attr('width', function (d) {
        return xscale(d);
      });


    var transitext = d3.select('#bars')
      .selectAll('text')
      .data(categories)
      .enter()
      .append('text')
      .attr({
        'x': function (d, i) {
          if (i == 0) {
            return xscale(0) + 5;
          } else if (i == 1) {
            return xscale(40) + 5;
          } else if (i == 2) {
            return xscale(54) + 5;
          } else if (i == 3) {
            return xscale(75) + 5;
          } else if (i == 4) {
            return xscale(85) + 5;
          } else if (i == 5) {
            return xscale(105) + 5;
          }
        },
        'y': function (d, i) {
          return yscale(i) - 10;
        }
      })
      .text(function (d) {
        return d;
      }).style({
        'fill': 'grey',
        'font-size': '12px'
      });



    // var transit = d3.select("svg").selectAll("rect")
    //             .data(year)
    //             .transition()
    //             .duration(1000)
    //             .attr("width", function(d) {return xscale(d); });
  </script>
  <script src="js/demo-donut.js"></script>
</body>

</html>